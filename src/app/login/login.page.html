<div class="welcome-container">
  <ion-content [fullscreen]="true" class="login-page">
    <div class="logo-container">
      <img src="../assets/icon/logo.jpg" alt="Logo" class="logo">
    </div>

    <ion-card class="login-card"><br>
      <ion-card-title>INICIAR SESION</ion-card-title>
      <ion-card-header class="login-container">
        <ion-card-content>
          <form (ngSubmit)="login()">
            <ion-item class="login-input">
              <ion-icon name="mail-outline" slot="start"></ion-icon>
              <ion-label position="floating" class="input-label">Correo o RUT</ion-label>
              <ion-input class="input-field" [(ngModel)]="identifier" name="identifier"></ion-input>
            </ion-item>
            <div *ngIf="identifierError" class="error-message">{{ identifierError }}</div>

            <ion-item class="login-input">
              <ion-icon name="shield-half-outline" slot="start"></ion-icon>
              <ion-label position="floating" class="input-label">Contraseña</ion-label>
              <ion-input class="input-field" type="password" [(ngModel)]="password" name="password"></ion-input>
            </ion-item>
            <div *ngIf="passwordError" class="error-message">{{ passwordError }}</div>

            <ion-button type="submit" class="login-button" expand="full" color="primary">
              Ingresar
            </ion-button>
          </form>

          <!-- Botón para abrir el modal de recuperación de contraseña -->
          <ion-button fill="clear" size="small" expand="block" (click)="openRecoverModal()">Recuperar Contraseña</ion-button>

          <!-- Modal de recuperación de contraseña -->
          <ion-modal [isOpen]="isRecoverModalOpen" (willDismiss)="onWillDismiss($event)">
            <ng-template>
              <ion-header>
                <ion-toolbar>
                  <ion-buttons slot="start">
                    <ion-button (click)="closeRecoverModal()">Cancelar</ion-button>
                  </ion-buttons>
                  <ion-title>Recuperar Contraseña</ion-title>
                  <ion-buttons slot="end">
                    <ion-button (click)="confirm()" [disabled]="!isValidEmail(identifier)">Confirmar</ion-button>
                  </ion-buttons>
                </ion-toolbar>
              </ion-header>
              <ion-content class="ion-padding">
                <ion-item>
                  <ion-input
                    label="Introduce tu correo o RUT"
                    labelPlacement="stacked"
                    type="text"
                    placeholder="Tu correo electrónico o RUT"
                    [(ngModel)]="identifier"
                    name="recoverIdentifier"
                  ></ion-input>
                </ion-item>
                <div *ngIf="recuperarContrasenaError" class="error-message">{{ recuperarContrasenaError }}</div>
                <div *ngIf="recuperarContrasenaSuccess" class="success-message">{{ recuperarContrasenaSuccess }}</div>
              </ion-content>
            </ng-template>
          </ion-modal>

          <!-- Modal para cambiar contraseña -->
          <ion-modal [isOpen]="isChangePasswordModalOpen" (willDismiss)="onWillDismiss($event)">
            <ng-template>
              <ion-header>
                <ion-toolbar>
                  <ion-buttons slot="start">
                    <ion-button (click)="closeChangePasswordModal()">Cancelar</ion-button>
                  </ion-buttons>
                  <ion-title>Cambiar Contraseña</ion-title>
                  <ion-buttons slot="end">
                    <ion-button (click)="cambiarContrasena()" [disabled]="!nuevaContrasena || !confirmarContrasena">Guardar</ion-button>
                  </ion-buttons>
                </ion-toolbar>
              </ion-header>
              <ion-content class="ion-padding">
                <ion-item>
                  <ion-label position="floating">Nueva Contraseña</ion-label>
                  <ion-input type="password" [(ngModel)]="nuevaContrasena" name="nuevaContrasena"></ion-input>
                </ion-item>
                <ion-item>
                  <ion-label position="floating">Confirmar Contraseña</ion-label>
                  <ion-input type="password" [(ngModel)]="confirmarContrasena" name="confirmarContrasena"></ion-input>
                </ion-item>
                <div *ngIf="recuperarContrasenaError" class="error-message">{{ recuperarContrasenaError }}</div>
                <div *ngIf="recuperarContrasenaSuccess" class="success-message">{{ recuperarContrasenaSuccess }}</div>
              </ion-content>
            </ng-template>
          </ion-modal>
        </ion-card-content>
      </ion-card-header>

      <ion-card-content>
        ¿No tienes cuenta? ¡Puedes crearla de manera gratuita aquí!
        <ion-button (click)="goToRegistro()" class="login-button" expand="full" color="primary">
          Registrarse
        </ion-button>
      </ion-card-content>
    </ion-card>
    <div class="back-button">
      <ion-button [routerLink]="['/home']" fill="clear" size="small">Volver</ion-button>
    </div>
  </ion-content>
</div>
